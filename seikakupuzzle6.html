<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>直感でわかる性格診断パズル</title>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- CSS: スタイル設定 (おしゃれ版) --- */
        :root {
            /* 主要カラー */
            --primary-blue: #3F51B5; /* 深みのある青 */
            --accent-green: #4CAF50; /* 成功時の緑 */
            --accent-orange: #FF9800; /* 警告/戻るボタンのオレンジ */
            --background-light: #E8EAF6; /* 薄い青紫系の背景 */
            --text-dark: #37474F; /* 濃いグレーのテキスト */
            --text-light: #ECEFF1; /* 明るいグレーのテキスト */
            --card-background: #FFFFFF; /* カード背景 */
            --border-color: #C5CAE9; /* 薄いボーダー */
            --shadow-color: rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Noto Sans JP', sans-serif; /* 日本語フォント優先 */
            background-color: var(--background-light);
            color: var(--text-dark);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box; /* パディングで横幅が広がらないように */
        }

        #app-container {
            background-color: var(--card-background);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 8px 25px var(--shadow-color); /* 影を柔らかく */
            width: 100%;
            max-width: 800px;
            border: 1px solid var(--border-color); /* 控えめなボーダー */
            transition: all 0.3s ease;
        }

        h1 {
            font-family: 'Lato', 'Noto Sans JP', sans-serif; /* タイトルは強調 */
            color: var(--primary-blue);
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.2em; /* 少し大きく */
            border-bottom: 3px solid var(--primary-blue);
            padding-bottom: 15px;
            letter-spacing: 0.05em; /* 文字間隔 */
        }

        /* 質問エリア */
        #quiz-area {
            text-align: center;
        }

        #question-text {
            font-size: 1.4em; /* 少し大きく */
            margin-bottom: 30px;
            color: var(--text-dark);
            min-height: 50px; /* 高さ確保 */
            font-weight: 700; /* 太字 */
        }

        /* 選択肢ボタンのコンテナ */
        #options-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); /* レスポンシブ対応 */
            gap: 20px;
            margin-top: 25px;
            text-align: center; /* 中央揃えに */
        }

        .option-button {
            background-color: var(--background-light); /* 背景色に薄い色 */
            color: var(--primary-blue);
            padding: 18px; /* パディングを増やす */
            border: 2px solid var(--primary-blue);
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em; /* 少し大きく */
            transition: all 0.3s ease; /* アニメーション */
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 90px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08); /* 控えめな影 */
        }

        .option-button:hover {
            background-color: var(--primary-blue);
            color: var(--card-background); /* 白文字 */
            transform: translateY(-5px); /* 少し浮き上がる */
            box-shadow: 0 6px 15px var(--shadow-color);
        }

        /* 制御ボタン (戻る/次へ) */
        #control-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 40px; /* 上余白を増やす */
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        #control-buttons button {
            padding: 12px 25px;
            font-weight: 700;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
        }

        #back-button {
            background-color: var(--accent-orange);
            color: var(--card-background);
            border: none;
        }

        #back-button:hover {
            background-color: #E68A00; /* 少し濃いオレンジ */
            transform: translateY(-2px);
        }

        /* 結果表示エリア */
        #result-area {
            text-align: center;
            padding: 30px;
            background-color: var(--background-light);
            border: 2px solid var(--accent-green); /* 緑のボーダー */
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        #result-area h2 {
            font-family: 'Lato', 'Noto Sans JP', sans-serif;
            color: var(--accent-green);
            font-size: 2.5em; /* 大きく */
            margin-bottom: 20px;
            letter-spacing: 0.08em;
        }

        #result-type {
            font-size: 2em; /* さらに大きく */
            font-weight: 700;
            color: var(--primary-blue); /* 青で強調 */
            margin-bottom: 25px;
            letter-spacing: 0.05em;
        }

        #result-summary {
            margin-bottom: 25px;
            padding: 15px;
            background-color: #E0F2F7; /* 明るい水色 */
            border-radius: 8px;
            border: 1px solid #B2EBF2;
            font-size: 1.05em;
            line-height: 1.7;
            text-align: left;
        }

        #result-analysis {
            font-size: 1.15em;
            line-height: 1.9; /* 行間を広く */
            text-align: left;
            margin-top: 25px;
            color: var(--text-dark);
        }

        #result-analysis p {
            margin-bottom: 1em;
        }

        /* 進行状況バー */
        #progress-bar {
            height: 12px; /* 少し太く */
            background-color: var(--border-color);
            border-radius: 6px;
            margin-bottom: 30px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        #progress-fill {
            height: 100%;
            width: 0%;
            background-color: var(--accent-green);
            border-radius: 6px;
            transition: width 0.4s ease-in-out;
        }
    </style>
</head>
<body>

    <div id="app-container">
        <h1>直感でわかる性格診断パズル</h1>

        <div id="progress-bar">
            <div id="progress-fill"></div>
        </div>

        <div id="quiz-area">
            <div id="question-text">診断を開始します。「スタート」ボタンを押してください。</div>
            
            <div id="options-container">
                <button id="start-button" class="option-button" onclick="startQuiz()">診断スタート！</button>
            </div>
            
            <div id="control-buttons" style="display: none;">
                <button id="back-button" onclick="goBack()">◀ 前の質問に戻る</button>
            </div>
        </div>

        <div id="result-area" style="display: none;">
            <h2>✨ 診断結果 ✨</h2>
            <div id="result-type"></div>
            <div id="result-summary"></div>
            <div id="result-analysis"></div>
            <button class="option-button" style="margin-top: 20px; width: 100%; background-color: var(--primary-blue); color: var(--card-background); border: none;" onclick="location.reload()">もう一度診断する</button>
        </div>
    </div>

    <script>
        // --- JavaScript: ロジック設定 (変更なし) ---

        // DOM要素の取得
        const quizArea = document.getElementById('quiz-area');
        const resultArea = document.getElementById('result-area');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const progressFill = document.getElementById('progress-fill');
        const controlButtons = document.getElementById('control-buttons');
        const backButton = document.getElementById('back-button');
        const resultType = document.getElementById('result-type');
        const resultSummary = document.getElementById('result-summary');
        const resultAnalysis = document.getElementById('result-analysis');

        // 診断の質問データ (全20問)
        const questions = [
            { text: "Q1. 週末の計画を立てるとき、どちらに惹かれますか？", options: [{ text: "綿密なスケジュールを組む", value: "S" }, { text: "何も決めずに、その場の気分で動く", value: "I" }] },
            { text: "Q2. 友人との会話では、どちらが多いですか？", options: [{ text: "積極的に発言し、議論をリードする", value: "A" }, { text: "聞き役に回り、発言は必要な時だけにする", value: "R" }] },
            { text: "Q3. 新しい趣味を始めるとき、どちらに惹かれますか？", options: [{ text: "基礎をしっかり学べる入門書", value: "S" }, { text: "とりあえず始めて、自分で試行錯誤する", value: "I" }] },
            { text: "Q4. トラブルが発生したとき、最初にすることは？", options: [{ text: "すぐに状況を把握し、対策を講じる", value: "A" }, { text: "少し立ち止まり、深く考える時間を持つ", value: "R" }] },
            { text: "Q5. 仕事（作業）環境は、どちらが好みですか？", options: [{ text: "整理整頓され、視界にノイズがない", value: "S" }, { text: "アイデアや資料が広がり、活発な状態", value: "I" }] },
            
            // --- パズル（直感）要素の多様化 ---
            { text: "Q6. 【直感パズル】「星、月、星、月、星...」次に続くと思う図形は？", options: [{ text: "星", value: "S" }, { text: "太陽", value: "I" }] }, 
            { text: "Q7. 【直感パズル】「青、緑、黄、橙、赤...」と続いた後、違和感なく感じる色は？", options: [{ text: "紫", value: "S" }, { text: "金色", value: "I" }] }, 
            { text: "Q8. 【直感パズル】「1, 4, 9, 16...」次に続くと思う数字は？", options: [{ text: "25", value: "S" }, { text: "20", value: "I" }] }, 
            // --- パズル（直感）要素 終了 ---

            { text: "Q9. 計画通りに進まないとき、気持ちはどうなりますか？", options: [{ text: "イライラするが、すぐに修正案を考える", value: "S" }, { text: "面白がる。新しい展開だと前向きに捉える", value: "I" }] },
            { text: "Q10. 新しい人を評価するとき、どこを重視しますか？", options: [{ text: "過去の実績と具体的なスキル", value: "S" }, { text: "隠された可能性や潜在的な才能", value: "I" }] },
            { text: "Q11. グループの決定で、あなたの役割は？", options: [{ text: "結論を出し、実行を促す", value: "A" }, { text: "メンバーの意見をまとめ、調和を保つ", value: "R" }] },
            { text: "Q12. 感情的な対立が起きたとき、どちらを選びますか？", options: [{ text: "すぐに介入し、問題を解決する", value: "A" }, { text: "一歩引いて、冷静に状況を分析する", value: "R" }] },
            { text: "Q13. 失敗したとき、最も強く感じるのは？", options: [{ text: "次はどうするかという対策の必要性", value: "A" }, { text: "何が原因だったのかという探求の必要性", value: "R" }] },
            { text: "Q14. 連絡手段として、どちらを好みますか？", options: [{ text: "電話や直接会話 (即時性)", value: "A" }, { text: "メールやチャット (文章での整理)", value: "R" }] },
            { text: "Q15. 夢や目標を語るとき、どちらの視点が多いですか？", options: [{ text: "達成するための具体的なプロセス", value: "S" }, { text: "実現したときの感情や世界観", value: "I" }] },
            { text: "Q16. 人前で意見を述べるのは得意ですか？", options: [{ text: "自信を持って、はっきりと話す", value: "A" }, { text: "準備ができていれば話せるが、できれば避けたい", value: "R" }] },
            { text: "Q17. 締め切りが近いとき、集中力は？", options: [{ text: "高まり、計画通りに加速する", value: "S" }, { text: "プレッシャーを感じ、新しいアイデアに逃げる", value: "I" }] },
            { text: "Q18. 友人に弱音を吐くのは得意ですか？", options: [{ text: "問題解決のために話すことはある", value: "A" }, { text: "あまり得意ではなく、自分で処理したい", value: "R" }] },
            { text: "Q19. 自分の感情は、普段どうですか？", options: [{ text: "一定で、あまり波がない", value: "S" }, { text: "豊かで、状況によって大きく変化する", value: "I" }] },
            { text: "Q20. あなたの行動の動機は、主にどちらですか？", options: [{ text: "目標達成と効率", value: "A" }, { text: "探求心と好奇心", value: "R" }] }
        ];

        let currentQuestionIndex = 0; // 現在の質問番号
        let userAnswers = [];         // ユーザーの回答履歴を保存

        // 性格タイプと分析結果の定義
        const personalityTypes = {
            "SA_strong": { type: "✨ 完璧主義の司令官 (The Organized Director)", analysis: "あなたは**計画性**と**行動力**が極めて高い、稀有なリーダータイプです。目標を設定したら、論理的かつ迅速に実行に移し、結果を出します。ただし、その厳格さが時に周囲にプレッシャーを与えることもあるため、柔軟な姿勢を意識すると、さらに多くの支持を得るでしょう。" },
            "SR_strong": { type: "💎 緻密な戦略家 (The Detailed Strategist)", analysis: "あなたは**安定性**を基盤に、**深い内省**を重ねて行動する学者肌の戦略家です。感情に流されず、リスクを徹底的に分析してから動き出すため、下した判断は非常に正確です。チームでは、あなたの分析力と準備の周到さが、不可欠な強みとなります。" },
            "IA_strong": { type: "🚀 情熱のイノベーター (The Passionate Innovator)", analysis: "あなたは**直感**と**行動力**が爆発的に結びついた、変化の旗振り役です。新しいアイデアが次々と湧き出し、それを実行に移すエネルギーを持っています。飽きっぽさが玉に瑕ですが、あなたの発想力と実行力は、停滞した状況を打ち破る最大の武器となります。" },
            "IR_strong": { type: "🌌 孤高の夢想家 (The Deep Dreamer)", analysis: "あなたは**直感**を羅針盤に、**内省的**な世界を探求する夢想家です。日常の裏に隠された可能性を見抜く才能があり、独創的な思考プロセスを持っています。集団行動より一人を好みますが、その独自のアイデアは、世界を静かに、しかし確実に変えていく力を持っています。" },
            "SA_balance": { type: "⚖️ 実務的な推進者 (The Practical Mover)", analysis: "あなたは、安定を求めながらも行動に移す**実践者**です。計画は立てますが、状況に応じて修正を加える柔軟性を持っています。バランスの良さが魅力であり、多くのチームで中核的な役割を果たします。" },
            "SR_balance": { type: "🕊️ 穏やかな探求者 (The Calm Explorer)", analysis: "あなたは、内省を重視しつつも、必要な場面では安定的な行動を選ぶ**調和型**です。急な変化は好みませんが、じっくり時間をかけて物事を探求し、知識を深めていくことを得意としています。人間関係においても、穏やかな信頼を築きます。" },
            "IA_balance": { type: "⚡ 柔軟なアイデアマン (The Adaptive Idea Generator)", analysis: "あなたは、直感を活かしつつも、適切なタイミングで行動を起こす**機転の利く**タイプです。様々なアイデアを試し、失敗を恐れません。あなたの周りには常に活気があり、新しいチャレンジが絶えません。" },
            "IR_balance": { type: "🎨 感受性豊かな表現者 (The Sensitive Creator)", analysis: "あなたは、内省を通じて直感的なひらめきを得る**感受性の高い**タイプです。芸術的なセンスや、人の気持ちを察する能力に優れています。独自の視点を持ちながらも、周囲の空気を読むことができる繊細さを持っています。" }
        };

        /**
         * 診断開始ボタンをクリックしたときの処理
         */
        function startQuiz() {
            userAnswers = [];
            currentQuestionIndex = 0;
            displayQuestion();
            controlButtons.style.display = 'flex';
        }

        /**
         * 質問と選択肢をDOMに表示する
         */
        function displayQuestion() {
            if (currentQuestionIndex >= questions.length) {
                showResult();
                return;
            }

            const q = questions[currentQuestionIndex];
            
            questionText.textContent = `Q${currentQuestionIndex + 1}/${questions.length}. ${q.text}`;
            
            const progress = (currentQuestionIndex / questions.length) * 100;
            progressFill.style.width = `${progress}%`;
            
            optionsContainer.innerHTML = '';

            q.options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'option-button';
                button.textContent = option.text;
                button.onclick = () => handleAnswer(option.value);
                optionsContainer.appendChild(button);
                
                // 既に回答済みの場合は、そのボタンをハイライト
                if (userAnswers[currentQuestionIndex] === option.value) {
                    button.style.backgroundColor = 'var(--primary-blue)';
                    button.style.color = 'var(--card-background)';
                } else {
                    button.style.backgroundColor = 'var(--background-light)';
                    button.style.color = 'var(--primary-blue)';
                }
            });
            
            // 戻るボタンの表示/非表示を制御
            backButton.style.visibility = currentQuestionIndex > 0 ? 'visible' : 'hidden';
        }

        /**
         * ユーザーが回答を選択したときの処理
         */
        function handleAnswer(value) {
            userAnswers[currentQuestionIndex] = value;
            currentQuestionIndex++;
            displayQuestion();
        }
        
        /**
         * 戻るボタンをクリックしたときの処理
         */
        function goBack() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        /**
         * 最終的な結果を表示する
         */
        function showResult() {
            progressFill.style.width = '100%';
            
            // 最終集計
            let score = { S: 0, I: 0, A: 0, R: 0 };
            userAnswers.forEach(answer => {
                score[answer] += 1;
            });

            quizArea.style.display = 'none';
            controlButtons.style.display = 'none';
            resultArea.style.display = 'block';

            // 1. 各軸のスコアを取得
            const sScore = score.S;
            const iScore = score.I;
            const aScore = score.A;
            const rScore = score.R;

            const sDominant = sScore - iScore; 
            const aDominant = aScore - rScore; 
            
            // 2. 最終タイプキーの決定ロジック (確実に存在するキーを生成)
            let firstAxisPrefix = ''; // 'S' or 'I'
            let secondAxisPrefix = ''; // 'A' or 'R'
            let axisSuffix = ''; // '_strong' or '_balance'

            const threshold = 3; // 20問中3点差を優位性の基準とする

            // S/I軸の判定
            if (sDominant >= threshold) {
                firstAxisPrefix = 'S';
            } else if (sDominant <= -threshold) {
                firstAxisPrefix = 'I';
            } else {
                firstAxisPrefix = (sScore >= iScore ? 'S' : 'I'); // 同点の場合はSを優先
            }

            // A/R軸の判定
            if (aDominant >= threshold) {
                secondAxisPrefix = 'A';
            } else if (aDominant <= -threshold) {
                secondAxisPrefix = 'R';
            } else {
                secondAxisPrefix = (aScore >= rScore ? 'A' : 'R'); // 同点の場合はAを優先
            }

            // 強さのサフィックスを決定
            // 少なくともどちらかの軸で強さが閾値を超えている場合、'strong'と見なす
            // それ以外は'balance'とする
            if ((sDominant >= threshold || sDominant <= -threshold) && 
                (aDominant >= threshold || aDominant <= -threshold)) {
                axisSuffix = '_strong';
            } else {
                axisSuffix = '_balance';
            }
            
            const finalKey = firstAxisPrefix + secondAxisPrefix + axisSuffix;
            
            // 4. 結果表示
            // ロジックによって生成されたfinalKeyが必ずpersonalityTypesに存在するように保証
            // ただし、万が一のフォールバックとして、デフォルトの結果も設定
            const result = personalityTypes[finalKey] || personalityTypes['SA_balance'];


            resultType.textContent = result.type;

            resultSummary.innerHTML = `
                <p><strong>【安定/直感】軸:</strong> S (計画/安定) ${sScore}点 vs I (直感/革新) ${iScore}点</p>
                <p><strong>【行動/内省】軸:</strong> A (行動/断言) ${aScore}点 vs R (内省/控えめ) ${rScore}点</p>
            `;

            resultAnalysis.innerHTML = `
                <p><strong>【${result.type}】の分析:</strong></p>
                <p>${result.analysis}</p>
                <p>※本診断はエンターテイメント目的です。あなたの深層心理を探るヒントとしてお楽しみください。</p>
            `;
        }

        document.addEventListener('DOMContentLoaded', () => {
             quizArea.style.display = 'block';
             resultArea.style.display = 'none';
        });
    </script>

</body>
</html>
